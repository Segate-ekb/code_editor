////////////////////////////////////////////////////////////////////////////////
// Форма консоли кода
// 
// Пример подключения редактора bsl_console к форме.
// Минимальный код подключения - см. ПриСозданииНаСервере и ПриОткрытии.
////////////////////////////////////////////////////////////////////////////////

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// === ПОДКЛЮЧЕНИЕ РЕДАКТОРА (1 строка) ===
	конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(ЭтотОбъект, УникальныйИдентификатор);
	
	// === ПРИМЕР: Добавление пользовательских переменных ===
	
	// Вариант 1: По ОписаниюТипов (для объектов конфигурации)
	// При вводе "_Товар." появятся все реквизиты справочника
	Если Метаданные.Справочники.Найти("Номенклатура") <> Неопределено Тогда
		конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Товар",
			Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
	КонецЕсли;
	
	// Вариант 2: По типу через Тип() - для общих классов платформы
	// При вводе "_Данные." появятся методы: Вставить(), Свойство(), Количество() и т.д.
	конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Данные",
		Тип("Структура"));
	// При вводе "_Таблица." появятся методы: Добавить(), Найти(), Скопировать() и т.д.
	конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Таблица",
		Тип("ТаблицаЗначений"));
	
	// Вариант 3: По строке с именем типа
	Если Метаданные.Справочники.Найти("Контрагенты") <> Неопределено Тогда
		конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Клиент",
			"Справочник.Контрагенты");
	КонецЕсли;
	
	// Вариант 4: Без типа - просто переменная
	конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Результат", Тип("Массив"));
	
	// === ПРИМЕР: Добавление пользовательских функций ===
	// Функция с параметрами
	ПараметрыФункции = Новый Массив;
	ПараметрыФункции.Добавить(конс_ПодключаемаяКонсольСервер.НовыйПараметрФункции("Сумма", "Число", "Сумма заказа для расчёта"));
	ПараметрыФункции.Добавить(конс_ПодключаемаяКонсольСервер.НовыйПараметрФункции("ПроцентСкидки", "Число", "Процент скидки (от 0 до 100)"));
	
	конс_ПодключаемаяКонсольСервер.ДобавитьФункциюВКонтекст(ЭтотОбъект,
		"ВычислитьСкидку",
		"Вычисляет скидку для клиента",
		ПараметрыФункции,
		"Число"); // тип возврата
	
	// Функция без параметров
	конс_ПодключаемаяКонсольСервер.ДобавитьФункциюВКонтекст(ЭтотОбъект,
		"ПолучитьТекущегоПользователя",
		"Возвращает текущего пользователя системы");
	
	// === ПРИМЕР: Добавление сниппетов (шаблонов кода) ===
	// Сниппет для цикла
	конс_ПодключаемаяКонсольСервер.ДобавитьСниппет(ЭтотОбъект,
		"Для",
		"Для ${1:Индекс} = ${2:0} По ${3:Количество} - 1 Цикл\n\t${0}\nКонецЦикла;",
		"Цикл Для по числовому счётчику");
	
	// Сниппет для запроса
	конс_ПодключаемаяКонсольСервер.ДобавитьСниппет(ЭтотОбъект,
		"Запрос",
		"Запрос = Новый Запрос;\nЗапрос.Текст = \n\t""ВЫБРАТЬ\n\t|\t${1:*}\n\t|ИЗ\n\t|\t${2:Справочник.Номенклатура}"";\n\nРезультат = Запрос.Выполнить();\nВыборка = Результат.Выбрать();\n\nПока Выборка.Следующий() Цикл\n\t${0}\nКонецЦикла;",
		"Создание и выполнение запроса");
	
	// Пример переопределения настроек:
	// Параметры = Новый Структура;
	// Параметры.Вставить("ПереопределитьНастройки", Новый Структура("КартаКода, Тема", Ложь, "ТемнаяТема"));
	// конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(ЭтотОбъект, УникальныйИдентификатор, Параметры);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	// === ПОДКЛЮЧЕНИЕ РЕДАКТОРА (1 строка) ===
	конс_ПодключаемаяКонсольКлиент.ПодключитьРедактор(ЭтаФорма);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура HTMLПриНажатии(Элемент, ДанныеСобытия, СтандартнаяОбработка)
	
	// === ОБРАБОТКА СОБЫТИЙ РЕДАКТОРА ===
	конс_ПодключаемаяКонсольКлиент.ОбработчикПриНажатии(ЭтаФорма, ДанныеСобытия);
	
КонецПроцедуры

&НаКлиенте
Процедура HTMLДокументСформирован(Элемент)
	
	// === ЗАВЕРШЕНИЕ ИНИЦИАЛИЗАЦИИ ===
	конс_ПодключаемаяКонсольКлиент.ОбработчикДокументСформирован(ЭтаФорма);
	
	// === ЗАГРУЗКА ПОЛЬЗОВАТЕЛЬСКОГО КОНТЕКСТА ===
	// Загружает переменные и функции добавленные в ПриСозданииНаСервере
	конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ВыполнитьКод(Команда)
	
	// === ВЫПОЛНЕНИЕ КОДА (3 строки) ===
	Код = конс_ПодключаемаяКонсольКлиент.ПодготовитьКодСПеременными(ЭтаФорма);
	
	Если Не ЗначениеЗаполнено(Код) Тогда
		ПоказатьПредупреждение(, "Нет кода для выполнения!");
		Возврат;
	КонецЕсли;
	
	Результат = конс_ПодключаемаяКонсольВызовСервера.ВыполнитьКодНаСервере(Код, конс_РежимПоказаПеременных);
	конс_ПодключаемаяКонсольКлиент.ОбработатьРезультат(ЭтаФорма, Результат);
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьНастройки(Команда)
	
	конс_ПодключаемаяКонсольКлиент.ОткрытьНастройкиРедактора();
	
КонецПроцедуры

&НаКлиенте
Процедура ПереключитьНаBSL(Команда)
	
	конс_ПодключаемаяКонсольКлиент.УстановитьРежимЯзыка(ЭтаФорма, "bsl");
	
КонецПроцедуры

&НаКлиенте
Процедура ПереключитьНаJSON(Команда)
	
	конс_ПодключаемаяКонсольКлиент.УстановитьРежимЯзыка(ЭтаФорма, "json");
	
КонецПроцедуры

&НаКлиенте
Процедура ПереключитьНаYAML(Команда)
	
	конс_ПодключаемаяКонсольКлиент.УстановитьРежимЯзыка(ЭтаФорма, "yaml");
	
КонецПроцедуры

#КонецОбласти
