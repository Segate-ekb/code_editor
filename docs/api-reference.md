# API Reference

Полный справочник по методам общих модулей консоли кода.

## Содержание

- [конс_ПодключаемаяКонсольКлиент](#конс_подключаемаяконсолькклиент) — Клиентский API
- [конс_ПодключаемаяКонсольСервер](#конс_подключаемаяконсольсервер) — Серверный API
- [конс_ПодключаемаяКонсольВызовСервера](#конс_подключаемаяконсольвызовсервера) — Серверные вызовы

---

## конс_ПодключаемаяКонсольКлиент

Клиентский API для работы с редактором кода.

### Инициализация

#### ПодключитьРедактор

Подключает редактор кода к форме. Вызывать в обработчике `ПриОткрытии`.

```bsl
Процедура ПодключитьРедактор(Форма, ИмяПоляHTML = Неопределено)
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `Форма` | ФормаКлиентскогоПриложения | Форма с полем HTML |
| `ИмяПоляHTML` | Строка | Имя элемента ПолеHTML (по умолчанию из настроек или "HTML") |

**Пример:**
```bsl
&НаКлиенте
Процедура ПриОткрытии(Отказ)
    конс_ПодключаемаяКонсольКлиент.ПодключитьРедактор(ЭтаФорма);
КонецПроцедуры
```

#### ОбработчикДокументСформирован

Обработчик события `ДокументСформирован` поля HTML. Завершает инициализацию редактора.

```bsl
Процедура ОбработчикДокументСформирован(Форма, ИмяПоляHTML = Неопределено)
```

**Пример:**
```bsl
&НаКлиенте
Процедура HTMLДокументСформирован(Элемент)
    конс_ПодключаемаяКонсольКлиент.ОбработчикДокументСформирован(ЭтаФорма);
КонецПроцедуры
```

#### ОбработчикПриНажатии

Обработчик события `ПриНажатии` поля HTML.

```bsl
Процедура ОбработчикПриНажатии(Форма, ДанныеСобытия, ИмяПоляHTML = Неопределено)
```

**Пример:**
```bsl
&НаКлиенте
Процедура HTMLПриНажатии(Элемент, ДанныеСобытия, СтандартнаяОбработка)
    конс_ПодключаемаяКонсольКлиент.ОбработчикПриНажатии(ЭтаФорма, ДанныеСобытия);
КонецПроцедуры
```

---

### Работа с текстом

#### ПолучитьТекст

Получает весь текст из редактора.

```bsl
Функция ПолучитьТекст(Форма, ИмяПоляHTML = Неопределено) -> Строка
```

**Пример:**
```bsl
Текст = конс_ПодключаемаяКонсольКлиент.ПолучитьТекст(ЭтаФорма);
```

#### УстановитьТекст

Устанавливает текст в редактор.

```bsl
Процедура УстановитьТекст(Форма, Текст, Позиция = 0, ИмяПоляHTML = Неопределено, УчитыватьОтступПервойСтроки = Ложь)
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `Текст` | Строка | Текст для установки |
| `Позиция` | Число | 0 - в начало, -1 - в конец |

**Пример:**
```bsl
конс_ПодключаемаяКонсольКлиент.УстановитьТекст(ЭтаФорма, "Сообщить(""Привет!"");");
```

#### ОчиститьТекст

Очищает редактор.

```bsl
Процедура ОчиститьТекст(Форма, ИмяПоляHTML = Неопределено)
```

#### ВставитьТекст

Вставляет текст в текущую позицию курсора.

```bsl
Процедура ВставитьТекст(Форма, Текст, ИмяПоляHTML = Неопределено)
```

#### ПолучитьВыделенныйТекст

Получает выделенный текст.

```bsl
Функция ПолучитьВыделенныйТекст(Форма, ИмяПоляHTML = Неопределено) -> Строка
```

---

### Выполнение кода

#### ВыполнитьКод

Выполняет код из редактора.

```bsl
Процедура ВыполнитьКод(Форма, НаСервере = Истина, ИмяПоляHTML = Неопределено)
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `НаСервере` | Булево | Выполнять на сервере (Истина) или клиенте (Ложь) |

#### ПодготовитьКодСПеременными

Подготавливает код для выполнения с добавлением сбора переменных.

```bsl
Функция ПодготовитьКодСПеременными(Форма, ФильтрПеременных = Неопределено, ИмяПоляHTML = Неопределено) -> Строка
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `ФильтрПеременных` | Массив/Неопределено | Имена переменных для сбора. Неопределено - все переменные |

**Пример:**
```bsl
// Собрать все переменные
Код = конс_ПодключаемаяКонсольКлиент.ПодготовитьКодСПеременными(ЭтаФорма);

// Собрать только указанные
Переменные = Новый Массив;
Переменные.Добавить("а");
Переменные.Добавить("Результат");
Код = конс_ПодключаемаяКонсольКлиент.ПодготовитьКодСПеременными(ЭтаФорма, Переменные);
```

#### ОбработатьРезультат

Обрабатывает результат выполнения кода.

```bsl
Процедура ОбработатьРезультат(Форма, Результат, ИмяПоляHTML = Неопределено)
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `Результат` | Структура | Результат от `ВыполнитьКодНаСервере` |

---

### Внешнее выполнение кода

#### ПолучитьКодДляВнешнегоВыполнения

Получает подготовленный код для выполнения во внешнем контексте.

```bsl
Функция ПолучитьКодДляВнешнегоВыполнения(Форма, РежимПоказаПеременных, ИмяПоляHTML = Неопределено, ФильтрПеременных = Неопределено) -> Структура
```

**Параметры:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| `Форма` | ФормаКлиентскогоПриложения | Форма с редактором |
| `РежимПоказаПеременных` | ПеречислениеСсылка.конс_РежимПоказаПеременных | Режим отображения переменных |
| `ИмяПоляHTML` | Строка | Имя элемента HTML (необязательный) |
| `ФильтрПеременных` | Массив, Неопределено | Массив имён переменных для анализа. Если не указано — анализируются все |

**Возвращает:**
- `Код` — полный код для выполнения
- `ИсходныйКод` — оригинальный код
- `АдресХраненияПеременных` — адрес хранилища для переменных
- `ИменаПеременных` — массив имён переменных
- `СмещениеСтрок` — количество служебных строк
- `РежимПоказаПеременных` — режим показа переменных

**Пример (все переменные):**
```bsl
ДанныеКода = конс_ПодключаемаяКонсольКлиент.ПолучитьКодДляВнешнегоВыполнения(
    ЭтаФорма, ПредопределенноеЗначение("Перечисление.конс_РежимПоказаПеременных.ВТабло"));
ИнфоОшибки = Неопределено;

Попытка
    Выполнить(ДанныеКода.Код);
Исключение
    ИнфоОшибки = ИнформацияОбОшибке();
КонецПопытки;

конс_ПодключаемаяКонсольКлиент.ОбработатьРезультатВнешнегоВыполнения(
    ЭтаФорма, ДанныеКода, ИнфоОшибки);
```

**Пример (фильтр переменных):**
```bsl
// Анализируем только переменные "Результат" и "Сумма"
ФильтрПеременных = Новый Массив;
ФильтрПеременных.Добавить("Результат");
ФильтрПеременных.Добавить("Сумма");

ДанныеКода = конс_ПодключаемаяКонсольКлиент.ПолучитьКодДляВнешнегоВыполнения(
    ЭтаФорма, 
    ПредопределенноеЗначение("Перечисление.конс_РежимПоказаПеременных.ВТабло"), 
    , 
    ФильтрПеременных);
```

#### ОбработатьРезультатВнешнегоВыполнения

Обрабатывает результат внешнего выполнения.

```bsl
Процедура ОбработатьРезультатВнешнегоВыполнения(Форма, ДанныеКода, ИнформацияОбОшибке, ИмяПоляHTML = Неопределено)
```

---

### Пользовательский контекст

#### ЗагрузитьПользовательскийКонтекст

Загружает переменные, функции и сниппеты в редактор.

```bsl
Процедура ЗагрузитьПользовательскийКонтекст(Форма, ИмяПоляHTML = Неопределено)
```

**Пример:**
```bsl
&НаКлиенте
Процедура HTMLДокументСформирован(Элемент)
    конс_ПодключаемаяКонсольКлиент.ОбработчикДокументСформирован(ЭтаФорма);
    конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
КонецПроцедуры
```

#### ЗагрузитьПользовательскиеОбъекты

Загружает пользовательские объекты (переменные) из JSON.

```bsl
Функция ЗагрузитьПользовательскиеОбъекты(Форма, JSONОбъектов, ИмяПоляHTML = Неопределено) -> Булево
```

#### ЗагрузитьПользовательскиеФункции

Загружает пользовательские функции из JSON.

```bsl
Функция ЗагрузитьПользовательскиеФункции(Форма, JSONФункций, ИмяПоляHTML = Неопределено) -> Булево
```

---

### Настройки

#### ПрименитьНастройки

Применяет настройки к редактору.

```bsl
Процедура ПрименитьНастройки(Форма, Настройки, ИмяПоляHTML = Неопределено)
```

#### УстановитьТему

Устанавливает тему оформления.

```bsl
Процедура УстановитьТему(Форма, ИмяТемы, ИмяПоляHTML = Неопределено)
```

| Значение | Описание |
|----------|----------|
| `СветлаяТема` | Светлая тема |
| `ТёмнаяТема` | Тёмная тема |
| `ВысокийКонтраст` | Высококонтрастная |

#### УстановитьРежимТолькоЧтение

Включает/выключает режим только чтение.

```bsl
Процедура УстановитьРежимТолькоЧтение(Форма, ТолькоЧтение, ИмяПоляHTML = Неопределено)
```

#### УстановитьРежимЯзыка

Устанавливает режим языка редактора.

```bsl
Процедура УстановитьРежимЯзыка(Форма, РежимЯзыка, ИмяПоляHTML = Неопределено)
```

| Значение | Описание |
|----------|----------|
| `bsl` | Язык 1С |
| `bsl_query` | Язык запросов |
| `dcs_query` | Язык СКД |
| `json` | JSON |
| `xml` | XML |
| `yaml` | YAML |

#### ЗагрузитьСниппетыИзФайла

Загружает сниппеты из файла шаблонов 1С (.st).

```bsl
Процедура ЗагрузитьСниппетыИзФайла(Форма, ПутьКФайлу, ИмяПоляHTML = Неопределено)
```

#### ЗагрузитьСниппетыИзJSON

Загружает сниппеты из JSON строки.

```bsl
Функция ЗагрузитьСниппетыИзJSON(Форма, JSONСниппетов, ИмяПоляHTML = Неопределено) -> Булево
```

#### ОткрытьНастройкиРедактора

Открывает форму настроек редактора.

```bsl
Процедура ОткрытьНастройкиРедактора()
```

---

## конс_ПодключаемаяКонсольСервер

Серверный API для инициализации и настройки редактора.

### Инициализация

#### ИнициализироватьРедактор

Инициализирует редактор на сервере. Вызывать в `ПриСозданииНаСервере`.

```bsl
Процедура ИнициализироватьРедактор(Форма, ИдентификаторФормы, ПараметрыИнициализации = Неопределено)
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `Форма` | ФормаКлиентскогоПриложения | Форма с полем HTML |
| `ИдентификаторФормы` | УникальныйИдентификатор | Идентификатор формы |
| `ПараметрыИнициализации` | Структура | Дополнительные параметры |

**Параметры инициализации:**
- `Версия` — версия для кэширования
- `ИмяПоляHTML` — имя элемента ПолеHTML
- `ПереопределитьНастройки` — структура с переопределяемыми настройками

**Пример:**
```bsl
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
    
    Параметры = Новый Структура;
    Параметры.Вставить("ИмяПоляHTML", "МоёПоле");
    Параметры.Вставить("ПереопределитьНастройки", Новый Структура("КартаКода", Ложь));
    
    конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(ЭтотОбъект, УникальныйИдентификатор, Параметры);
    
КонецПроцедуры
```

---

### Добавление переменных

#### ДобавитьПеременную

Добавляет переменную в контекст автодополнения.

```bsl
Процедура ДобавитьПеременную(Форма, ИмяПеременной, ТипИлиЗначение = Неопределено)
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `ИмяПеременной` | Строка | Имя переменной |
| `ТипИлиЗначение` | ОписаниеТипов/Тип/Строка/Произвольный | Тип или значение |

**Примеры:**
```bsl
// По ОписаниюТипов
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Товар",
    Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));

// По типу
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Данные", Тип("Структура"));

// По строке
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Клиент", "Справочник.Контрагенты");

// По значению
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Клиент", СсылкаНаКонтрагента);

// По результату ТипЗнч() - для динамического определения типа
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_ИсходныеДанные", 
    ТипЗнч(Объект.Пример));
```

---

### Добавление функций

#### ДобавитьФункциюВКонтекст

Добавляет функцию в контекст автодополнения.

```bsl
Процедура ДобавитьФункциюВКонтекст(Форма, ИмяФункции, Описание = "", Параметры = Неопределено, ТипВозврата = "")
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `ИмяФункции` | Строка | Имя функции |
| `Описание` | Строка | Описание функции |
| `Параметры` | Массив | Массив параметров (см. НовыйПараметрФункции) |
| `ТипВозврата` | Строка | Тип возвращаемого значения |

#### НовыйПараметрФункции

Создаёт описание параметра функции.

```bsl
Функция НовыйПараметрФункции(Имя, Тип, Описание = "", Обязательный = Истина) -> Структура
```

**Пример:**
```bsl
Параметры = Новый Массив;
Параметры.Добавить(конс_ПодключаемаяКонсольСервер.НовыйПараметрФункции("Сумма", "Число", "Сумма заказа"));
Параметры.Добавить(конс_ПодключаемаяКонсольСервер.НовыйПараметрФункции("Скидка", "Число", "Процент", Ложь));

конс_ПодключаемаяКонсольСервер.ДобавитьФункциюВКонтекст(ЭтотОбъект,
    "ВычислитьСкидку",
    "Вычисляет итоговую сумму",
    Параметры,
    "Число");
```

---

### Добавление сниппетов

#### ДобавитьСниппет

Добавляет сниппет (шаблон кода).

```bsl
Процедура ДобавитьСниппет(Форма, Префикс, ТелоСниппета, Описание = "")
```

| Параметр | Тип | Описание |
|----------|-----|----------|
| `Префикс` | Строка | Текст для активации |
| `ТелоСниппета` | Строка | Шаблон с точками табуляции |
| `Описание` | Строка | Описание сниппета |

**Пример:**
```bsl
конс_ПодключаемаяКонсольСервер.ДобавитьСниппет(ЭтотОбъект,
    "Для",
    "Для ${1:Индекс} = ${2:0} По ${3:Количество} - 1 Цикл
    |	${0}
    |КонецЦикла;",
    "Цикл Для");
```

---

### Настройки

#### ПолучитьНастройкиИзХранилища

Получает настройки пользователя из хранилища.

```bsl
Функция ПолучитьНастройкиИзХранилища() -> Структура
```

#### СохранитьНастройкиВХранилище

Сохраняет настройки в хранилище.

```bsl
Процедура СохранитьНастройкиВХранилище(Настройки)
```

#### НастройкиПоУмолчанию

Возвращает настройки по умолчанию.

```bsl
Функция НастройкиПоУмолчанию() -> Структура
```

---

### Получение JSON

#### ПолучитьJSONПеременных

Получает JSON переменных для загрузки в редактор.

```bsl
Функция ПолучитьJSONПеременных(Форма) -> Строка
```

#### ПолучитьJSONФункций

Получает JSON функций для загрузки в редактор.

```bsl
Функция ПолучитьJSONФункций(Форма) -> Строка
```

---

### Выполнение кода

#### ВыполнитьКодНаСервере

Выполняет код на сервере.

```bsl
Функция ВыполнитьКодНаСервере(Код, РежимПоказаПеременных) -> Структура
```

**Возвращает:**
- `Успешно` — результат выполнения
- `ОписаниеОшибки` — текст ошибки
- `ИнформацияОбОшибке` — полная информация об ошибке
- `ОписаниеПеременных` — JSON с переменными
- `АдресХраненияПеременных` — адрес хранилища

#### НовыйРезультатВыполнения

Создаёт пустую структуру результата.

```bsl
Функция НовыйРезультатВыполнения() -> Структура
```

---

## конс_ПодключаемаяКонсольВызовСервера

Модуль для серверных вызовов с клиента.

#### ВыполнитьКодНаСервере

Выполняет код на сервере (вызывается с клиента).

```bsl
Функция ВыполнитьКодНаСервере(Код, РежимПоказаПеременных) -> Структура
```

#### СоздатьВременноеХранилищеПеременных

Создаёт временное хранилище для переменных.

```bsl
Функция СоздатьВременноеХранилищеПеременных(ИдентификаторФормы) -> Строка
```

#### ОбработатьРезультатВнешнегоВыполнения

Обрабатывает результат внешнего выполнения.

```bsl
Функция ОбработатьРезультатВнешнегоВыполнения(АдресХраненияПеременных, РазобраннаяИнформацияОбОшибке, РежимПоказаПеременных) -> Структура
```

---

## Перечисления

### конс_РежимПоказаПеременных

| Значение | Описание |
|----------|----------|
| `НеПоказывать` | Переменные не отображаются |
| `ВТабло` | Отображение в табло |
| `ВПодсказках` | Отображение при наведении |

---

## См. также

- [Быстрый старт](quick-start.md)
- [Добавление переменных](variables.md)
- [Добавление функций](functions.md)
- [Сниппеты](snippets.md)
- [Настройки](settings.md)
