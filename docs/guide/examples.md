# Примеры

## Минимальная консоль

Самый простой вариант — редактор без выполнения кода:

```bsl
// === ПриСозданииНаСервере ===
конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(
    ЭтотОбъект, УникальныйИдентификатор);

// === ПриОткрытии ===
конс_ПодключаемаяКонсольКлиент.ПодключитьРедактор(ЭтаФорма);

// === HTMLДокументСформирован ===
конс_ПодключаемаяКонсольКлиент.ОбработчикДокументСформирован(ЭтаФорма);

// === HTMLПриНажатии ===
конс_ПодключаемаяКонсольКлиент.ОбработчикПриНажатии(ЭтаФорма, ДанныеСобытия);
```

---

## Консоль с выполнением кода

```bsl
&НаКлиенте
Процедура ВыполнитьКод(Команда)

    Код = конс_ПодключаемаяКонсольКлиент.ПодготовитьКодСПеременными(ЭтаФорма);

    Если Не ЗначениеЗаполнено(Код) Тогда
        Возврат;
    КонецЕсли;

    Результат = конс_ПодключаемаяКонсольВызовСервера.ВыполнитьКодНаСервере(
        Код,
        ПредопределенноеЗначение("Перечисление.конс_РежимПоказаПеременных.ВТабло"));

    конс_ПодключаемаяКонсольКлиент.ОбработатьРезультат(ЭтаФорма, Результат);

КонецПроцедуры
```

---

## Внешнее выполнение (в своём контексте)

Когда нужно выполнить код в контексте модуля объекта или с доступом к данным формы:

```bsl
&НаКлиенте
Процедура ВнешнееВыполнение(Команда)

    // 1. Получаем подготовленный код
    ДанныеКода = конс_ПодключаемаяКонсольКлиент.ПолучитьКодДляВнешнегоВыполнения(
        ЭтаФорма,
        РежимПоказаПеременных);

    Если Не ЗначениеЗаполнено(ДанныеКода.ИсходныйКод) Тогда
        Возврат;
    КонецЕсли;

    // 2. Выполняем в своём контексте
    ИнфоОшибки = Неопределено;
    Попытка
        ВыполнитьНаСервере(ДанныеКода.Код);
    Исключение
        ИнфоОшибки = ИнформацияОбОшибке();
    КонецПопытки;

    // 3. Обрабатываем результат
    конс_ПодключаемаяКонсольКлиент.ОбработатьРезультатВнешнегоВыполнения(
        ЭтаФорма, ДанныеКода, ИнфоОшибки);

КонецПроцедуры

&НаСервере
Процедура ВыполнитьНаСервере(Код)
    Выполнить(Код);
КонецПроцедуры
```

---

## Добавление пользовательских переменных

Переменные добавляются на сервере, загружаются на клиенте:

```bsl
// === ПриСозданииНаСервере ===

// По ОписаниюТипов — появятся реквизиты справочника в автодополнении
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект,
    "_Товар", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));

// По типу платформы
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект,
    "_Данные", Тип("Структура"));

// По строке с именем типа
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект,
    "_Клиент", "Справочник.Контрагенты");

// === HTMLДокументСформирован ===
конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
```

После этого при вводе `_Товар.` в редакторе появятся реквизиты справочника `Номенклатура`.

---

## Добавление пользовательских функций

```bsl
// === ПриСозданииНаСервере ===

// Функция с параметрами и возвращаемым типом
Параметры = Новый Массив;
Параметры.Добавить(конс_ПодключаемаяКонсольСервер.НовыйПараметрФункции(
    "Сумма", "Число", "Сумма заказа для расчёта"));
Параметры.Добавить(конс_ПодключаемаяКонсольСервер.НовыйПараметрФункции(
    "ПроцентСкидки", "Число", "Процент скидки (0-100)"));

конс_ПодключаемаяКонсольСервер.ДобавитьФункциюВКонтекст(ЭтотОбъект,
    "ВычислитьСкидку",
    "Вычисляет скидку для клиента",
    Параметры,
    "Число");

// Функция без параметров
конс_ПодключаемаяКонсольСервер.ДобавитьФункциюВКонтекст(ЭтотОбъект,
    "ПолучитьТекущегоПользователя",
    "Возвращает текущего пользователя системы");

// === HTMLДокументСформирован ===
конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
```

---

## Добавление сниппетов

Сниппеты разворачиваются по `Tab`. Поддерживаются tab-stop: `${1}`, `${2}`, `${0}` (финальная позиция).

```bsl
// === ПриСозданииНаСервере ===

конс_ПодключаемаяКонсольСервер.ДобавитьСниппет(ЭтотОбъект,
    "Запрос",
    "Запрос = Новый Запрос;
    |Запрос.Текст =
    |   ""ВЫБРАТЬ
    |   |   ${1:*}
    |   |ИЗ
    |   |   ${2:Справочник.Номенклатура}"";
    |
    |Результат = Запрос.Выполнить();
    |Выборка = Результат.Выбрать();
    |
    |Пока Выборка.Следующий() Цикл
    |   ${0}
    |КонецЦикла;",
    "Создание и выполнение запроса");

// === HTMLДокументСформирован ===
конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
```

Загрузка из `.st`-файла:

```bsl
конс_ПодключаемаяКонсольКлиент.ЗагрузитьСниппетыИзФайла(ЭтаФорма, "C:\шаблоны\мои_шаблоны.st");
```

---

## Переопределение темы при инициализации

```bsl
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

    Параметры = Новый Структура;
    Параметры.Вставить("ИмяПоляHTML", "ПолеРедактора");
    Параметры.Вставить("ПереопределитьНастройки", Новый Структура);
    Параметры.ПереопределитьНастройки.Вставить("Тема", "ТемнаяТема");
    Параметры.ПереопределитьНастройки.Вставить("КартаКода", Ложь);
    Параметры.ПереопределитьНастройки.Вставить("БыстрыеПодсказки", Истина);
    Параметры.ПереопределитьНастройки.Вставить("СтрокаСостояния", Ложь);

    конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(
        ЭтотОбъект, УникальныйИдентификатор, Параметры);

КонецПроцедуры
```

---

## Управление текстом

```bsl
// Получить текст
Текст = конс_ПодключаемаяКонсольКлиент.ПолучитьТекст(ЭтаФорма);

// Установить текст
конс_ПодключаемаяКонсольКлиент.УстановитьТекст(ЭтаФорма, "Сообщить(""Привет!"");");

// Вставить в позицию курсора
конс_ПодключаемаяКонсольКлиент.ВставитьТекст(ЭтаФорма, "// вставленный комментарий");

// Очистить
конс_ПодключаемаяКонсольКлиент.ОчиститьТекст(ЭтаФорма);

// Получить выделенный текст
Выделение = конс_ПодключаемаяКонсольКлиент.ПолучитьВыделенныйТекст(ЭтаФорма);
```

---

## Управление ошибками

```bsl
// Пометить строку с ошибкой (мигающая подсветка)
конс_ПодключаемаяКонсольКлиент.ПометитьОшибку(ЭтаФорма, 15, 10);

// Очистить все маркеры
конс_ПодключаемаяКонсольКлиент.ОчиститьМаркерыОшибок(ЭтаФорма);

// Показать сообщение через CodeLens
конс_ПодключаемаяКонсольКлиент.ПоказатьСообщениеВРедакторе(ЭтаФорма, "Код выполнен успешно!");

// Показать ошибку с разбором строки/колонки
конс_ПодключаемаяКонсольКлиент.ПоказатьОшибкуВыполнения(ЭтаФорма, ОписаниеОшибки());
```

---

## Полный пример формы

```bsl
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

    // Инициализация с тёмной темой и без миникарты
    Параметры = Новый Структура;
    Параметры.Вставить("ПереопределитьНастройки", Новый Структура);
    Параметры.ПереопределитьНастройки.Вставить("Тема", "ТемнаяТема");
    Параметры.ПереопределитьНастройки.Вставить("КартаКода", Ложь);

    конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(
        ЭтотОбъект, УникальныйИдентификатор, Параметры);

    // Пользовательский контекст
    конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект,
        "_Данные", Тип("Структура"));

КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
    конс_ПодключаемаяКонсольКлиент.ПодключитьРедактор(ЭтаФорма);
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура HTMLДокументСформирован(Элемент)
    конс_ПодключаемаяКонсольКлиент.ОбработчикДокументСформирован(ЭтаФорма);
    конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
КонецПроцедуры

&НаКлиенте
Процедура HTMLПриНажатии(Элемент, ДанныеСобытия, СтандартнаяОбработка)
    конс_ПодключаемаяКонсольКлиент.ОбработчикПриНажатии(ЭтаФорма, ДанныеСобытия);
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ВыполнитьКод(Команда)

    Код = конс_ПодключаемаяКонсольКлиент.ПодготовитьКодСПеременными(ЭтаФорма);

    Если Не ЗначениеЗаполнено(Код) Тогда
        Возврат;
    КонецЕсли;

    Результат = конс_ПодключаемаяКонсольВызовСервера.ВыполнитьКодНаСервере(Код,
        ПредопределенноеЗначение("Перечисление.конс_РежимПоказаПеременных.ВТабло"));
    конс_ПодключаемаяКонсольКлиент.ОбработатьРезультат(ЭтаФорма, Результат);

КонецПроцедуры

&НаКлиенте
Процедура ОткрытьНастройки(Команда)
    конс_ПодключаемаяКонсольКлиент.ОткрытьНастройкиРедактора();
КонецПроцедуры

#КонецОбласти
```
