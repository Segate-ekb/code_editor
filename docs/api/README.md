# API: Серверный модуль

`конс_ПодключаемаяКонсольСервер` — основной серверный модуль. Вызывается в `ПриСозданииНаСервере`.

## Инициализация

### ИнициализироватьРедактор

```bsl
конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(
    Форма,                      // ФормаКлиентскогоПриложения
    ИдентификаторФормы,          // УникальныйИдентификатор
    ПараметрыИнициализации)      // Структура | Строка | ЭлементФормы | Неопределено
```

Автоматически:
- Создаёт служебный реквизит `конс_СтруктураПараметровРедактораКода`
- Загружает исходники редактора из макета
- Собирает общие модули для автодополнения
- Применяет настройки пользователя

## Пользовательский контекст

### ДобавитьПеременную

```bsl
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(
    Форма,          // ФормаКлиентскогоПриложения (ЭтотОбъект)
    Имя,            // Строка — имя переменной
    ТипИлиЗначение) // ОписаниеТипов | Тип | Строка | Значение | Неопределено
```

| Что передать | Результат |
|-------------|-----------|
| `Новый ОписаниеТипов("СправочникСсылка.Номенклатура")` | Автодополнение реквизитов справочника |
| `Тип("Структура")` | Автодополнение методов типа |
| `"Справочник.Контрагенты"` | Автодополнение по строковому имени типа |
| Конкретное значение | Определяется тип по значению |

### ДобавитьФункциюВКонтекст

```bsl
конс_ПодключаемаяКонсольСервер.ДобавитьФункциюВКонтекст(
    Форма,          // ФормаКлиентскогоПриложения
    Имя,            // Строка — имя функции
    Описание,       // Строка — описание (необязательно)
    Параметры,      // Массив — массив параметров (необязательно)
    ТипВозврата)    // Строка — тип возвращаемого значения (необязательно)
```

### НовыйПараметрФункции

```bsl
Параметр = конс_ПодключаемаяКонсольСервер.НовыйПараметрФункции(
    Имя,            // Строка
    Тип,            // Строка — тип параметра
    Описание,       // Строка (необязательно)
    Обязательный)   // Булево (необязательно)
```

### ДобавитьСниппет

```bsl
конс_ПодключаемаяКонсольСервер.ДобавитьСниппет(
    Форма,          // ФормаКлиентскогоПриложения
    Префикс,        // Строка — триггер ввода
    Тело,           // Строка — шаблон с ${1}, ${2}, ${0}
    Описание)       // Строка (необязательно)
```

## Настройки

### НастройкиПоУмолчанию

```bsl
Настройки = конс_ПодключаемаяКонсольСервер.НастройкиПоУмолчанию();
// Возвращает: Структура с ключами Тема, БыстрыеПодсказки, КартаКода, ...
```

### ПолучитьНастройкиИзХранилища / СохранитьНастройкиВХранилище

```bsl
Настройки = конс_ПодключаемаяКонсольСервер.ПолучитьНастройкиИзХранилища();
Настройки.Тема = "ТемнаяТема";
конс_ПодключаемаяКонсольСервер.СохранитьНастройкиВХранилище(Настройки);
```

## Метаданные

### ПолучитьКоллекциюОбщихМодулей

```bsl
Модули = конс_ПодключаемаяКонсольСервер.ПолучитьКоллекциюОбщихМодулей();
// Структура: ключ = имя модуля, значение = пустая структура
// Только неглобальные модули
```

### ПолучитьМетаданныеДляРедактора

```bsl
Мета = конс_ПодключаемаяКонсольСервер.ПолучитьМетаданныеДляРедактора();
// Содержит: Справочники, Документы, Перечисления, РегистрыСведений, РегистрыНакопления
```

## Выполнение кода

### ВыполнитьКодНаСервере

```bsl
Результат = конс_ПодключаемаяКонсольСервер.ВыполнитьКодНаСервере(
    Код,            // Строка — BSL-код для выполнения
    РежимПеременных)// ПеречислениеСсылка.конс_РежимПоказаПеременных
```

### СоздатьКонтекстВыполнения

```bsl
Контекст = конс_ПодключаемаяКонсольСервер.СоздатьКонтекстВыполнения(
    ИдентификаторФормы,
    РежимПеременных) // необязательно
```

---

# API: Клиентский модуль

`конс_ПодключаемаяКонсольКлиент` — клиентский модуль. Мост между формой и JS-редактором.

## Инициализация

| Метод | Где вызывать |
|-------|-------------|
| `ПодключитьРедактор(Форма)` | `ПриОткрытии` |
| `ОбработчикДокументСформирован(Форма)` | `HTMLДокументСформирован` |
| `ОбработчикПриНажатии(Форма, ДанныеСобытия)` | `HTMLПриНажатии` |

## Текст

| Метод | Описание |
|-------|----------|
| `ПолучитьТекст(Форма)` | Всё содержимое редактора |
| `УстановитьТекст(Форма, Текст, Позиция)` | Установить текст. Позиция: `0`=начало, `-1`=конец |
| `ВставитьТекст(Форма, Текст)` | В позицию курсора |
| `ОчиститьТекст(Форма)` | Очистить |
| `ПолучитьВыделенныйТекст(Форма)` | Выделенный фрагмент |
| `ПолучитьПеременныеИзКода(Форма)` | Массив имён переменных |

## Выполнение кода

| Метод | Описание |
|-------|----------|
| `ПодготовитьКодСПеременными(Форма, Фильтр)` | Код с добавленным сбором переменных |
| `ОбработатьРезультат(Форма, Результат)` | Отобразить результат (ошибки/переменные) |
| `ПолучитьКодДляВнешнегоВыполнения(Форма, Режим, ..., Фильтр)` | Код для `Выполнить()` в своём контексте |
| `ОбработатьРезультатВнешнегоВыполнения(Форма, ДанныеКода, ИнфоОшибки)` | Обработать результат внешнего выполнения |

## Настройки

| Метод | Описание |
|-------|----------|
| `ПрименитьНастройки(Форма, Настройки)` | Применить структуру настроек |
| `УстановитьТему(Форма, Тема)` | Сменить тему |
| `УстановитьРежимТолькоЧтение(Форма, Булево)` | Включить/выключить read-only |
| `УстановитьРежимЯзыка(Форма, Режим)` | Сменить язык: `bsl`, `bsl_query`, `dcs_query`, `json`, `xml`, `yaml` |
| `ОткрытьНастройкиРедактора()` | Открыть форму настроек |

## Контекст

| Метод | Описание |
|-------|----------|
| `ЗагрузитьПользовательскийКонтекст(Форма)` | Загрузить переменные/функции/сниппеты из сервера |
| `ЗагрузитьПользовательскиеОбъекты(Форма, JSON)` | Загрузить объекты из JSON |
| `ЗагрузитьПользовательскиеФункции(Форма, JSON)` | Загрузить функции из JSON |
| `ЗагрузитьСниппетыИзФайла(Форма, Путь)` | Загрузить сниппеты из `.st`-файла |
| `ЗагрузитьСниппетыИзJSON(Форма, JSON)` | Загрузить сниппеты из JSON |

## Отображение

| Метод | Описание |
|-------|----------|
| `ПоказатьПеременныеВТабло(Форма, JSON)` | Панель переменных (дерево) |
| `ПоказатьПеременныеВПодсказках(Форма, JSON)` | Переменные как hover-подсказки |
| `ПоказатьСообщениеВРедакторе(Форма, Текст)` | Сообщение через CodeLens |
| `ПометитьОшибку(Форма, Строка, Колонка)` | Мигающая подсветка ошибки |
| `ОчиститьМаркерыОшибок(Форма)` | Убрать все маркеры |
| `ПоказатьОшибкуВыполнения(Форма, ОписаниеОшибки)` | Показать ошибку с позиционированием |

## Ошибки

| Метод | Описание |
|-------|----------|
| `РазобратьИнформациюОбОшибке(ИнфоОшибки)` | Разбор `ИнформацияОбОшибке` → Структура |
| `СформироватьТекстОшибкиСоСтеком(ОписаниеОшибки)` | Текст ошибки со стеком вызовов |
