# Добавление пользовательских переменных

Пользовательские переменные расширяют контекст автодополнения редактора. После добавления переменной редактор будет предлагать её при вводе и показывать свойства и методы её типа.

## Быстрый пример

```bsl
// В ПриСозданииНаСервере
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Товар", 
    Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));

// В HTMLДокументСформирован (на клиенте)
конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
```

После этого при вводе `_Товар.` появятся все реквизиты справочника Номенклатура.

## Способы указания типа

### 1. Через ОписаниеТипов

Рекомендуемый способ для объектов конфигурации:

```bsl
// Справочник
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Товар",
    Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));

// Документ
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Заказ",
    Новый ОписаниеТипов("ДокументСсылка.ЗаказКлиента"));

// Регистр сведений
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Цена",
    Новый ОписаниеТипов("РегистрСведенийМенеджерЗаписи.Цены"));
```

### 2. Через Тип()

Для типов платформы (коллекции, примитивы):

```bsl
// Структура
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Данные",
    Тип("Структура"));

// Таблица значений
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Таблица",
    Тип("ТаблицаЗначений"));

// Массив
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Список",
    Тип("Массив"));

// Соответствие
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Словарь",
    Тип("Соответствие"));
```

### 3. Через строку с именем типа

Удобно для объектов метаданных:

```bsl
// По полному имени метаданных
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Клиент",
    "Справочник.Контрагенты");

конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Накладная",
    "Документ.РасходнаяНакладная");
```

### 4. По значению

Тип определяется автоматически:

```bsl
// По ссылке - тип определится автоматически
СсылкаНаКлиента = Справочники.Контрагенты.НайтиПоКоду("00001");
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Клиент", СсылкаНаКлиента);

// По пустой ссылке
ПустаяСсылка = Справочники.Номенклатура.ПустаяСсылка();
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Товар", ПустаяСсылка);
```

### 5. Через ТипЗнч()

Для динамического определения типа по существующему значению:

```bsl
// По типу существующего значения
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_ИсходныеДанные", 
    ТипЗнч(Объект.Пример));

// Определение типа реквизита формы
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_ТекущийЭлемент", 
    ТипЗнч(Объект.Элементы[0]));
```

### 6. Без типа

Переменная добавляется без контекстного автодополнения:

```bsl
// Просто переменная - методы типа не будут предлагаться
конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Результат");
```

## Полный пример

```bsl
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
    
    // Инициализация редактора
    конс_ПодключаемаяКонсольСервер.ИнициализироватьРедактор(ЭтотОбъект, УникальныйИдентификатор);
    
    // Добавление переменных
    ДобавитьПользовательскиеПеременные();
    
КонецПроцедуры

&НаСервере
Процедура ДобавитьПользовательскиеПеременные()
    
    // Переменные для работы с товарами
    Если Метаданные.Справочники.Найти("Номенклатура") <> Неопределено Тогда
        конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Товар",
            Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
    КонецЕсли;
    
    // Переменные для работы с клиентами
    Если Метаданные.Справочники.Найти("Контрагенты") <> Неопределено Тогда
        конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Клиент",
            "Справочник.Контрагенты");
    КонецЕсли;
    
    // Переменные для структур данных
    конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Данные", Тип("Структура"));
    конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Таблица", Тип("ТаблицаЗначений"));
    конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_Результат", Тип("Массив"));
    
КонецПроцедуры

&НаКлиенте
Процедура HTMLДокументСформирован(Элемент)
    
    // Обязательный вызов
    конс_ПодключаемаяКонсольКлиент.ОбработчикДокументСформирован(ЭтаФорма);
    
    // Загрузка переменных в редактор
    конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскийКонтекст(ЭтаФорма);
    
КонецПроцедуры
```

## Динамическое добавление переменных

Переменные можно добавлять и после инициализации:

```bsl
&НаКлиенте
Процедура ДобавитьПеременнуюДинамически(Команда)
    
    // Подготовка JSON на сервере
    JSONПеременных = ПодготовитьНовуюПеременнуюНаСервере();
    
    // Загрузка в редактор
    конс_ПодключаемаяКонсольКлиент.ЗагрузитьПользовательскиеОбъекты(ЭтаФорма, JSONПеременных);
    
КонецПроцедуры

&НаСервере
Функция ПодготовитьНовуюПеременнуюНаСервере()
    
    // Добавляем переменную в форму
    конс_ПодключаемаяКонсольСервер.ДобавитьПеременную(ЭтотОбъект, "_НоваяПеременная", 
        Тип("Структура"));
    
    // Получаем JSON для передачи на клиент
    Возврат конс_ПодключаемаяКонсольСервер.ПолучитьJSONПеременных(ЭтотОбъект);
    
КонецФункции
```

## Соглашения об именовании

Рекомендуется использовать префикс `_` для пользовательских переменных:

- `_Товар` — ссылка на товар
- `_Клиент` — ссылка на клиента
- `_Данные` — структура данных
- `_Результат` — результат операции

Это позволяет:
1. Визуально отличать их от других переменных
2. Группировать в начале списка автодополнения
3. Избегать конфликтов с переменными пользователя

## Работа автодополнения

После добавления переменных:

1. **При вводе имени переменной** — редактор предлагает `_Товар`, `_Клиент` и др.

2. **При вводе точки после переменной** — показываются свойства и методы типа:
   ```
   _Товар.  →  Наименование, Код, Артикул, ЕдиницаИзмерения, ...
   ```

3. **При вводе точки вложенного свойства**:
   ```
   _Товар.ЕдиницаИзмерения.  →  Наименование, Код, ...
   ```

## Поддерживаемые типы

### Объекты конфигурации

- Справочники (`СправочникСсылка.XXX`)
- Документы (`ДокументСсылка.XXX`)
- Регистры сведений (`РегистрСведенийМенеджерЗаписи.XXX`)
- Регистры накопления
- Перечисления
- Планы видов характеристик
- Планы счетов
- Планы обмена
- Бизнес-процессы
- Задачи

### Типы платформы

- Структура
- Соответствие
- Массив
- ТаблицаЗначений
- ДеревоЗначений
- СписокЗначений
- HTTP-объекты
- XML-объекты
- И другие

## См. также

- [Добавление функций](functions.md)
- [Сниппеты](snippets.md)
- [API Reference](api-reference.md)
